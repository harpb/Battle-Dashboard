// Generated by CoffeeScript 1.6.3
(function() {
  var BattleApp, BattleController;

  BattleController = function($scope, Restangular, Auth) {
    var battleApi, defaultValue, exampleDateTime, getBattles, getPlayers, placeholder, playerApi;
    $scope.authentication_credentials = {
      username: 'harp',
      password: 'great',
      isAuthenticated: false
    };
    $scope.login = function() {
      Auth.setCredentials($scope.authentication_credentials.username, $scope.authentication_credentials.password);
      $scope.authentication_credentials.isAuthenticated = true;
      getBattles();
      return getPlayers();
    };
    playerApi = Restangular.all("player/");
    battleApi = Restangular.all("battle/");
    getPlayers = function() {
      return $scope.playerList = playerApi.getList().then(function(response) {
        $scope.players = response['objects'];
        return console.info('players', $scope.players, $scope.playerList);
      });
    };
    $scope.newPlayerForm = new AngularForm('.new.player.modal');
    $scope.newPlayerForm.addField('nickname', 'Nickname');
    $scope.newPlayerForm.addField('first_name', 'First Name');
    $scope.newPlayerForm.addField('last_name', 'Last Name');
    $scope.savePlayer = function($event) {
      $event.preventDefault();
      return $scope.newPlayerForm.submit(playerApi, $scope.players);
    };
    $scope.editPlayer = function(player) {
      return player.editing = true;
    };
    $scope.updatePlayer = function(player) {
      return player.editing = false;
    };
    getBattles = function() {
      return $scope.battleList = battleApi.getList().then(function(response) {
        return $scope.battles = response['objects'];
      });
    };
    exampleDateTime = '2013-12-10 6:10:00';
    $scope.newBattleForm = new AngularForm('.new.battle.modal');
    $scope.newBattleForm.addField('attacker', 'Attacker');
    $scope.newBattleForm.addField('defender', 'Defender');
    $scope.newBattleForm.addField('winner', 'Winner');
    $scope.newBattleForm.addField('start', 'Start', placeholder = exampleDateTime);
    $scope.newBattleForm.addField('end', 'End', placeholder = exampleDateTime, defaultValue = exampleDateTime);
    $scope.battlePlayerFields = [$scope.newBattleForm.fields.attacker, $scope.newBattleForm.fields.defender];
    $scope.battleDatetimeFields = [$scope.newBattleForm.fields.start, $scope.newBattleForm.fields.end];
    $scope.saveBattle = function($event) {
      $event.preventDefault();
      return $scope.newBattleForm.submit(battleApi, $scope.battles);
    };
    return $scope.login();
  };

  BattleApp = angular.module('BattleApp', ['restangular']);

  window.BattleApp = BattleApp;

  BattleApp.config(function(RestangularProvider) {
    return RestangularProvider.setBaseUrl('/api/v1/');
  });

  BattleApp.config(function($interpolateProvider) {
    $interpolateProvider.startSymbol('<<');
    return $interpolateProvider.endSymbol('>>');
  });

  BattleApp.controller('BattleController', BattleController);

}).call(this);
